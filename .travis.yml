---
language: python
python: "2.7"

addons:
  apt:
    packages:
      - curl

sudo: required

addons:
  apt:
    packages:
      - curl

sudo: required

before_install:
  - pwd
  - "sudo apt-get -y install lsb_release || true"
  - curl https://storage.googleapis.com/git-repo-downloads/repo > /tmp/repo
  - chmod a+x /tmp/repo
  - sudo mv /tmp/repo /bin/repo
  - git config --global user.email "you@example.com"
  - git config --global user.name "Your Name"
  - "[ -d /opt/chaperone ] || sudo mkdir -p /opt/chaperone"
  # get the username portion from github
  - export GIT_USER=${TRAVIS_REPO_SLUG%/*}
  - export CHAPERONE_BRANCH="master"
  - git ls-remote --exit-code --heads https://github.com/$GIT_USER/chaperone "$TRAVIS_BRANCH" && CHAPERONE_BRANCH=$TRAVIS_BRANCH || true

install:
  - pip install ansible ansible-lint

script:
  - cd /tmp
  - echo "y" | repo init -u https://github.com/$GIT_USER/chaperone -b $CHAPERONE_BRANCH -g chaperone
  - repo sync
  - cd ansible/playbooks/ansible
  - ansible-playbook -i inventory ansible.yml
